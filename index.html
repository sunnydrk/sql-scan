// pom.xml
// Place this file at the root of your project as pom.xml

<project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.example</groupId>
  <artifactId>sqli-scanner</artifactId>
  <version>1.0-SNAPSHOT</version>
  <properties>
    <java.version>11</java.version>
  </properties>
  <dependencies>
    <!-- Spark Java micro-framework -->
    <dependency>
      <groupId>com.sparkjava</groupId>
      <artifactId>spark-core</artifactId>
      <version>2.9.4</version>
    </dependency>
    <!-- Jsoup for HTML parsing -->
    <dependency>
      <groupId>org.jsoup</groupId>
      <artifactId>jsoup</artifactId>
      <version>1.15.4</version>
    </dependency>
  </dependencies>
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.8.1</version>
        <configuration>
          <source>${java.version}</source>
          <target>${java.version}</target>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-shade-plugin</artifactId>
        <version>3.2.4</version>
        <executions>
          <execution>
            <phase>package</phase>
            <goals><goal>shade</goal></goals>
            <configuration>
              <transformers>
                <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                  <mainClass>com.example.SqliScanner</mainClass>
                </transformer>
              </transformers>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
</project>


// src/main/java/com/example/SqliScanner.java
package com.example;

import static spark.Spark.*;
import spark.Request;
import spark.Response;
import java.net.http.*;
import java.net.*;
import java.util.*;
import java.util.regex.*;

public class SqliScanner {
    public static void main(String[] args) {
        port(4567);

        // Serve HTML form
        get("/", (req, res) -> htmlForm());

        // Handle scan
        post("/scan", (req, res) -> {
            String url = req.queryParams("url");
            List<String> payloads = List.of("'", "' OR '1'='1", "'--", "\" OR \"1\"=\"1\"", "';--");
            List<Pattern> errors = List.of(
                Pattern.compile("SQL syntax", Pattern.CASE_INSENSITIVE),
                Pattern.compile("mysql_fetch", Pattern.CASE_INSENSITIVE),
                Pattern.compile("ORA-01756", Pattern.CASE_INSENSITIVE),
                Pattern.compile("Unclosed quotation mark", Pattern.CASE_INSENSITIVE)
            );

            StringBuilder out = new StringBuilder();
            out.append("<h2>Scan Results for ").append(url).append("</h2>");
            out.append("<ul>");

            HttpClient client = HttpClient.newHttpClient();
            for (String p : payloads) {
                String testUrl = url.replace("<INJECT>", URLEncoder.encode(p, "UTF-8"));
                out.append("<li>Payload <code>").append(p).append("</code>: ");
                try {
                    HttpRequest request = HttpRequest.newBuilder()
                        .uri(URI.create(testUrl))
                        .GET()
                        .build();
                    HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());
                    String body = response.body();
                    boolean vuln = errors.stream().anyMatch(rx -> rx.matcher(body).find());
                    if (vuln) out.append("<span style='color:red'>VULNERABLE</span>");
                    else out.append("<span style='color:green'>SAFE</span>");
                } catch (Exception e) {
                    out.append("<span style='color:orange'>ERROR (CORS/Network)</span>");
                }
                out.append("</li>");
            }
            out.append("</ul><p><a href='/'>Back</a></p>");
            res.type("text/html");
            return out.toString();
        });
    }

    private static String htmlForm() {
        return "<!DOCTYPE html>" +
               "<html><head><title>SQLi Scanner</title>" +
               "<style>body{font-family:sans-serif;padding:20px;}input,button{padding:8px;margin:5px;}button{cursor:pointer;} code{background:#eee;padding:2px;} </style>" +
               "</head><body>" +
               "<h1>SQL Injection Scanner</h1>" +
               "<form method='post' action='/scan'>" +
               "<p>Enter URL with <code>&lt;INJECT&gt;</code> placeholder:</p>" +
               "<input name='url' size='50' placeholder='http://target/page.php?id=<INJECT>' required>" +
               "<button type='submit'>Scan</button>" +
               "</form></body></html>";
    }
}
